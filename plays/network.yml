require 'puppet'
require 'puppet/reports'

# Define a new report handler named 'package_notifier'
Puppet::Reports.register_report(:package_notifier) do
  desc "A report handler that logs newly installed packages."

  # Process the report
  def process
    log_file = '/var/log/puppet/package_changes.log'

    File.open(log_file, 'a') do |file|
      self.resource_statuses.each do |resource, status|
        if status.changed && resource =~ /^Package\[/
          file.puts("Package installed: #{resource} on #{Time.now}")
        end
      end
    end
  end
end


